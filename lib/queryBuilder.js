import _concatInstanceProperty from "@babel/runtime-corejs3/core-js-stable/instance/concat";
import _type from "ramda/src/type";
import _forEachObjIndexed from "ramda/src/forEachObjIndexed";
import _mergeDeepLeft from "ramda/src/mergeDeepLeft";
import _defineProperty from "@babel/runtime-corejs3/helpers/esm/defineProperty";
import _reduceInstanceProperty from "@babel/runtime-corejs3/core-js-stable/instance/reduce";
import _pickBy from "ramda/src/pickBy";
import _assoc from "ramda/src/assoc";
import _includesInstanceProperty from "@babel/runtime-corejs3/core-js-stable/instance/includes";
import _reduce from "ramda/src/reduce";
import _Object$assign from "@babel/runtime-corejs3/core-js-stable/object/assign";
import _path from "ramda/src/path";
import _mapObjIndexed from "ramda/src/mapObjIndexed";
import _propOr from "ramda/src/propOr";
import _identity from "ramda/src/identity";
import _filter from "ramda/src/filter";
import _includes from "ramda/src/includes";
import _map from "ramda/src/map";
import _prop from "ramda/src/prop";
import _pipe from "ramda/src/pipe";
import _pathOr from "ramda/src/pathOr";
import _union from "ramda/src/union";
import { VariableType } from 'json-to-graphql-query';

/*
create
edit
index
select
detail
tooltip
check_delete
delete
search
*/
export var QueryType;

(function (QueryType) {
  QueryType["INDEX"] = "index";
  QueryType["DETAIL"] = "detail";
  QueryType["SELECT"] = "select";
  QueryType["TOOLTIP"] = "tooltip";
  QueryType["INDEX_REL"] = "indexRelationship";
  QueryType["DETAIL_REL"] = "detailRelationship";
  QueryType["SELECT_REL"] = "selectRelationship";
  QueryType["SEARCH"] = "search";
  QueryType["CREATE"] = "create";
  QueryType["UPDATE"] = "update";
  QueryType["DELETE"] = "delete";
  QueryType["DELETE_CASCADES"] = "deleteCascades";
})(QueryType || (QueryType = {}));

var getRequiredFields = function getRequiredFields(model) {
  return _union(['__typeName', 'id'], _pathOr([], ['queryRequired'], model));
};

var getRelTableFields = function getRelTableFields(_ref) {
  var fieldName = _ref.fieldName,
      model = _ref.model;
  return _pathOr([], ['fields', fieldName, 'type', 'tableFields'], model);
};

var getQueryName = function getQueryName(schema, modelName, queryType) {
  var model = schema.getModel(modelName);

  switch (queryType) {
    case QueryType.INDEX:
    case QueryType.SELECT:
      return model.queryAllName;

    case QueryType.DETAIL:
    case QueryType.TOOLTIP:
      return model.queryName;

    case QueryType.CREATE:
    case QueryType.UPDATE:
    case QueryType.DELETE:
      return model.queryName;

    default:
      return queryType;
  }
};

var getSortVariable = function getSortVariable(modelName) {
  return "".concat(modelName, "Sort");
};

var getListVariables = function getListVariables(modelName) {
  return {
    filter: "".concat(modelName, "Filter"),
    sort: "[".concat(getSortVariable(modelName), "!]"),
    page: 'Page'
  };
};

var detailVariables = {
  id: 'Int!'
};

var getVariables = function getVariables(_ref2) {
  var modelName = _ref2.modelName,
      queryType = _ref2.queryType;

  switch (queryType) {
    case QueryType.INDEX:
      return getListVariables(modelName);

    case QueryType.DELETE:
    case QueryType.DETAIL:
    case QueryType.TOOLTIP:
      return detailVariables;

    case QueryType.SELECT:
      return {
        sort: "[".concat(getSortVariable(modelName), "!]")
      };

    case QueryType.SEARCH:
      return {
        queryString: 'String!'
      };

    case QueryType.CREATE:
      return {
        input: "".concat(modelName, "InputRequired!")
      };

    case QueryType.UPDATE:
      return {
        input: "".concat(modelName, "Input!"),
        id: 'Int!'
      };

    case QueryType.DELETE_CASCADES:
      return {
        modelName: 'String!',
        id: 'Int!'
      };
  }
};

var getArgs = function getArgs(queryType) {
  switch (queryType) {
    case QueryType.INDEX:
      return {
        filter: new VariableType('filter'),
        sort: new VariableType('sort'),
        page: new VariableType('page')
      };

    case QueryType.DELETE:
    case QueryType.DETAIL:
    case QueryType.TOOLTIP:
      return {
        id: new VariableType('id')
      };

    case QueryType.SELECT:
      return {
        sort: new VariableType('sort')
      };

    case QueryType.SEARCH:
      return {
        queryString: new VariableType('queryString')
      };

    case QueryType.CREATE:
      return {
        input: new VariableType('input')
      };

    case QueryType.UPDATE:
      return {
        input: new VariableType('input'),
        id: new VariableType('id')
      };

    case QueryType.DELETE_CASCADES:
      return {
        tableName: new VariableType('modelName'),
        id: new VariableType('id')
      };
  }
};

var getFieldQueryType = function getFieldQueryType(queryType) {
  switch (queryType) {
    case QueryType.INDEX:
      return QueryType.INDEX_REL;

    case QueryType.DETAIL:
      return QueryType.DETAIL_REL;

    case QueryType.SELECT:
      return QueryType.SELECT_REL;

    default:
      return queryType;
  }
};

var getQueryIndexFields = function getQueryIndexFields(schema, modelName) {
  var indexFields = schema.getIndexFields({
    modelName: modelName,
    customProps: {}
  });

  var fields = _pipe(_prop('fields'), _map(function (field) {
    return _includes(_prop('fieldName', field), indexFields) || _prop('queryIndex', field);
  }))(schema.getModel(modelName));

  return _filter(_identity, fields);
};

var getQueryDetailFields = function getQueryDetailFields(schema, modelName) {
  var fields = _filter(function (field) {
    return (_propOr(true, 'showDetail', field) || _prop('queryDetail', field)) && !_prop('virtualField', field);
  }, schema.getFields(modelName));

  var model = schema.getModel(modelName);
  return _mapObjIndexed(function (val, key) {
    var show = _pathOr(true, ['fields', key, 'showDetail'], model) || _path(['fields', key, 'queryDetail'], model);

    return _pathOr(show, ['fields', key, 'type', 'type'], model);
  }, fields);
}; // needs to be removed?


var makeRelayNodeConnection = function makeRelayNodeConnection(nodeQueryObj) {
  return _Object$assign({
    __typename: true
  }, nodeQueryObj);
};

var getRelFieldObject = function getRelFieldObject(_ref3) {
  var schema = _ref3.schema,
      modelName = _ref3.modelName,
      fieldName = _ref3.fieldName;
  var relFieldObject = {
    id: true
  };

  var targetModel = _path(['type', 'target'], schema.getField(modelName, fieldName));

  var targetModelDisplayField = _propOr('name', 'displayField', schema.getModel(targetModel));

  if (targetModelDisplayField) {
    relFieldObject[targetModelDisplayField] = true;
  } // todo: targetModelDisplayField can be function and not string???


  return relFieldObject;
};

var buildTooltipFieldsObject = function buildTooltipFieldsObject(_ref4) {
  var schema = _ref4.schema,
      modelName = _ref4.modelName;
  // todo: insert customProps from outside application
  var fields = schema.getTooltipFields({
    modelName: modelName,
    customProps: {}
  });
  return _pipe(_reduce(function (accumulator, fieldName) {
    var type = schema.getType(modelName, fieldName);

    if (_includesInstanceProperty(type).call(type, 'ToMany')) {
      return _assoc(fieldName, makeRelayNodeConnection(getRelFieldObject({
        schema: schema,
        modelName: modelName,
        fieldName: fieldName
      })), accumulator);
    } else if (_includesInstanceProperty(type).call(type, 'ToOne')) {
      return _assoc(fieldName, getRelFieldObject({
        schema: schema,
        modelName: modelName,
        fieldName: fieldName
      }), accumulator);
    } else {
      return _assoc(fieldName, true, accumulator);
    }
  }, {}))(fields);
};

var pickFields = function pickFields(arr, fields) {
  return _pickBy(function (val, key) {
    return _includes(key, arr);
  }, fields);
};

var buildFieldsObject = function buildFieldsObject(_ref5) {
  var schema = _ref5.schema,
      queryType = _ref5.queryType,
      modelName = _ref5.modelName,
      _ref5$queryFields = _ref5.queryFields,
      queryFields = _ref5$queryFields === void 0 ? [] : _ref5$queryFields;
  var model = schema.getModel(modelName);
  var required = getRequiredFields(model);

  var requiredObj = _reduceInstanceProperty(required).call(required, function (acc, val) {
    return _Object$assign({}, acc, _defineProperty({}, val, true));
  }, {});

  if (queryType === QueryType.TOOLTIP) {
    return buildTooltipFieldsObject({
      schema: schema,
      modelName: modelName
    });
  }

  var fields = function () {
    switch (queryType) {
      case QueryType.INDEX:
        return getQueryIndexFields(schema, modelName);

      case QueryType.DETAIL:
        return getQueryDetailFields(schema, modelName);

      case QueryType.DETAIL_REL:
        return pickFields(queryFields, getQueryDetailFields(schema, modelName));

      default:
        return {};
    }
  }();

  fields = _mergeDeepLeft(requiredObj, fields); // replace with query object when fieldName is Relationship type

  fields = _mapObjIndexed(function (val, key) {
    var field = schema.getField(modelName, key);

    if (!schema.isRel(modelName, key)) {
      return val;
    }

    return buildFieldsObject({
      schema: schema,
      queryType: getFieldQueryType(queryType),
      modelName: _path(['type', 'target'], field),
      queryFields: getRelTableFields({
        model: model,
        fieldName: key
      })
    });
  }, fields);
  return fields;
};

var buildSearchFieldsArray = function buildSearchFieldsArray(schema) {
  var fieldsArray = [];

  _forEachObjIndexed(function (model) {
    if (schema.getSearchable(model.modelName)) {
      fieldsArray.push(buildSearchFieldsObject(schema, model));
    }
  }, schema.schemaJSON);

  return fieldsArray;
};

var buildSearchFieldsObject = function buildSearchFieldsObject(schema, model) {
  var required = getRequiredFields(model);

  var requiredObj = _reduceInstanceProperty(required).call(required, function (acc, val) {
    return _Object$assign({}, acc, _defineProperty({}, val, true));
  }, {});

  var fields = {};
  fields.id = true;

  if (_type(model.displayField) === 'String') {
    fields[model.displayField] = true;
  }

  fields = _mergeDeepLeft(requiredObj, fields);
  fields.__typeName = model.modelName;
  fields = _mapObjIndexed(function (val, key) {
    var field = schema.getField(model.modelName, key);

    if (!schema.isRel(model.modelName, key)) {
      return val;
    }

    return buildSearchFieldsObject(schema, schema.getModel(_path(['type', 'target'], field)));
  }, fields);
  return fields;
};

var buildDeleteCascadesArray = function buildDeleteCascadesArray(schema) {
  var cascadesArray = [];

  _forEachObjIndexed(function (model) {
    cascadesArray.push(buildCascadesObject(schema, model));
  }, schema.schemaJSON);

  return cascadesArray;
};

var buildCascadesObject = function buildCascadesObject(schema, model) {
  var required = getRequiredFields(model);

  var requiredObj = _reduceInstanceProperty(required).call(required, function (acc, val) {
    return _Object$assign({}, acc, _defineProperty({}, val, true));
  }, {});

  var cascades = {};
  cascades.__typename = true;
  cascades.id = true;

  if (_type(model.displayField) === 'String') {
    cascades[model.displayField] = true;
  }

  cascades = _mergeDeepLeft(requiredObj, cascades);
  cascades.__typeName = model.modelName;
  cascades = _mapObjIndexed(function (val, key) {
    var field = schema.getField(model.modelName, key);

    if (!schema.isRel(model.modelName, key)) {
      return val;
    }

    return buildCascadesObject(schema, schema.getModel(_path(['type', 'target'], field)));
  }, cascades);
  return cascades;
};

export var makeQueryBuilder = function makeQueryBuilder(schema) {
  return function (_ref6) {
    var _context;

    var modelName = _ref6.modelName,
        _ref6$queryType = _ref6.queryType,
        queryType = _ref6$queryType === void 0 ? QueryType.INDEX : _ref6$queryType;
    var queryName = getQueryName(schema, modelName, queryType);
    var queryVariables = getVariables({
      modelName: modelName,
      queryType: queryType
    });

    switch (queryType) {
      case QueryType.INDEX:
      case QueryType.DETAIL:
      case QueryType.SELECT:
      case QueryType.TOOLTIP:
        return {
          query: _defineProperty({
            __variables: queryVariables
          }, queryName, {
            __args: getArgs(queryType),
            result: _Object$assign({}, buildFieldsObject({
              schema: schema,
              modelName: modelName,
              queryType: queryType
            })),
            errors: true,
            count: queryType === QueryType.INDEX
          })
        };

      case QueryType.SEARCH:
        return {
          query: {
            __variables: queryVariables,
            search: {
              __args: getArgs(queryType),
              __typename: true,
              __on: buildSearchFieldsArray(schema)
            }
          }
        };

      case QueryType.CREATE:
      case QueryType.UPDATE:
      case QueryType.DELETE:
        return {
          mutation: _defineProperty({
            __variables: queryVariables
          }, _concatInstanceProperty(_context = "".concat(queryType)).call(_context, modelName), {
            __args: getArgs(queryType),
            result: {
              __typename: true,
              id: true
            },
            errors: true
          })
        };

      case QueryType.DELETE_CASCADES:
        return {
          query: {
            __variables: queryVariables,
            checkDelete: {
              __args: getArgs(queryType),
              __on: buildDeleteCascadesArray(schema)
            }
          }
        };
    }
  };
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9xdWVyeUJ1aWxkZXIudHMiXSwibmFtZXMiOlsiVmFyaWFibGVUeXBlIiwiUXVlcnlUeXBlIiwiZ2V0UmVxdWlyZWRGaWVsZHMiLCJtb2RlbCIsImdldFJlbFRhYmxlRmllbGRzIiwiZmllbGROYW1lIiwiZ2V0UXVlcnlOYW1lIiwic2NoZW1hIiwibW9kZWxOYW1lIiwicXVlcnlUeXBlIiwiZ2V0TW9kZWwiLCJJTkRFWCIsIlNFTEVDVCIsInF1ZXJ5QWxsTmFtZSIsIkRFVEFJTCIsIlRPT0xUSVAiLCJxdWVyeU5hbWUiLCJDUkVBVEUiLCJVUERBVEUiLCJERUxFVEUiLCJnZXRTb3J0VmFyaWFibGUiLCJnZXRMaXN0VmFyaWFibGVzIiwiZmlsdGVyIiwic29ydCIsInBhZ2UiLCJkZXRhaWxWYXJpYWJsZXMiLCJpZCIsImdldFZhcmlhYmxlcyIsIlNFQVJDSCIsInF1ZXJ5U3RyaW5nIiwiaW5wdXQiLCJERUxFVEVfQ0FTQ0FERVMiLCJnZXRBcmdzIiwidGFibGVOYW1lIiwiZ2V0RmllbGRRdWVyeVR5cGUiLCJJTkRFWF9SRUwiLCJERVRBSUxfUkVMIiwiU0VMRUNUX1JFTCIsImdldFF1ZXJ5SW5kZXhGaWVsZHMiLCJpbmRleEZpZWxkcyIsImdldEluZGV4RmllbGRzIiwiY3VzdG9tUHJvcHMiLCJmaWVsZHMiLCJmaWVsZCIsImdldFF1ZXJ5RGV0YWlsRmllbGRzIiwiZ2V0RmllbGRzIiwidmFsIiwia2V5Iiwic2hvdyIsIm1ha2VSZWxheU5vZGVDb25uZWN0aW9uIiwibm9kZVF1ZXJ5T2JqIiwiX190eXBlbmFtZSIsImdldFJlbEZpZWxkT2JqZWN0IiwicmVsRmllbGRPYmplY3QiLCJ0YXJnZXRNb2RlbCIsImdldEZpZWxkIiwidGFyZ2V0TW9kZWxEaXNwbGF5RmllbGQiLCJidWlsZFRvb2x0aXBGaWVsZHNPYmplY3QiLCJnZXRUb29sdGlwRmllbGRzIiwiYWNjdW11bGF0b3IiLCJ0eXBlIiwiZ2V0VHlwZSIsInBpY2tGaWVsZHMiLCJhcnIiLCJidWlsZEZpZWxkc09iamVjdCIsInF1ZXJ5RmllbGRzIiwicmVxdWlyZWQiLCJyZXF1aXJlZE9iaiIsImFjYyIsImlzUmVsIiwiYnVpbGRTZWFyY2hGaWVsZHNBcnJheSIsImZpZWxkc0FycmF5IiwiZ2V0U2VhcmNoYWJsZSIsInB1c2giLCJidWlsZFNlYXJjaEZpZWxkc09iamVjdCIsInNjaGVtYUpTT04iLCJkaXNwbGF5RmllbGQiLCJfX3R5cGVOYW1lIiwiYnVpbGREZWxldGVDYXNjYWRlc0FycmF5IiwiY2FzY2FkZXNBcnJheSIsImJ1aWxkQ2FzY2FkZXNPYmplY3QiLCJjYXNjYWRlcyIsIm1ha2VRdWVyeUJ1aWxkZXIiLCJxdWVyeVZhcmlhYmxlcyIsInF1ZXJ5IiwiX192YXJpYWJsZXMiLCJfX2FyZ3MiLCJyZXN1bHQiLCJlcnJvcnMiLCJjb3VudCIsInNlYXJjaCIsIl9fb24iLCJtdXRhdGlvbiIsImNoZWNrRGVsZXRlIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQ0EsU0FBU0EsWUFBVCxRQUE2Qix1QkFBN0I7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBLFdBQVlDLFNBQVo7O1dBQVlBLFM7QUFBQUEsRUFBQUEsUztBQUFBQSxFQUFBQSxTO0FBQUFBLEVBQUFBLFM7QUFBQUEsRUFBQUEsUztBQUFBQSxFQUFBQSxTO0FBQUFBLEVBQUFBLFM7QUFBQUEsRUFBQUEsUztBQUFBQSxFQUFBQSxTO0FBQUFBLEVBQUFBLFM7QUFBQUEsRUFBQUEsUztBQUFBQSxFQUFBQSxTO0FBQUFBLEVBQUFBLFM7R0FBQUEsUyxLQUFBQSxTOztBQW1CWixJQUFNQyxpQkFBaUIsR0FBRyxTQUFwQkEsaUJBQW9CLENBQUNDLEtBQUQ7QUFBQSxTQUN4QixPQUFRLENBQUMsWUFBRCxFQUFlLElBQWYsQ0FBUixFQUE4QixRQUFTLEVBQVQsRUFBYSxDQUFDLGVBQUQsQ0FBYixFQUFnQ0EsS0FBaEMsQ0FBOUIsQ0FEd0I7QUFBQSxDQUEx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QUN2RSxNQUFEO0FBRm5CO0FBRlI7QUFERixTQUFQO0FBOUNKO0FBd0RELEdBbEVEO0FBbUVELENBcEVNIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgUiBmcm9tICdyYW1kYSdcbmltcG9ydCB7IFZhcmlhYmxlVHlwZSB9IGZyb20gJ2pzb24tdG8tZ3JhcGhxbC1xdWVyeSdcbmltcG9ydCB7IFNjaGVtYUJ1aWxkZXIgfSBmcm9tICdAYXV0b2ludmVudC9jb252ZXlvci1zY2hlbWEnXG5cbi8qXG5jcmVhdGVcbmVkaXRcbmluZGV4XG5zZWxlY3RcbmRldGFpbFxudG9vbHRpcFxuY2hlY2tfZGVsZXRlXG5kZWxldGVcbnNlYXJjaFxuKi9cblxuZXhwb3J0IGVudW0gUXVlcnlUeXBlIHtcbiAgSU5ERVggPSAnaW5kZXgnLFxuICBERVRBSUwgPSAnZGV0YWlsJyxcbiAgU0VMRUNUID0gJ3NlbGVjdCcsXG4gIFRPT0xUSVAgPSAndG9vbHRpcCcsXG4gIElOREVYX1JFTCA9ICdpbmRleFJlbGF0aW9uc2hpcCcsXG4gIERFVEFJTF9SRUwgPSAnZGV0YWlsUmVsYXRpb25zaGlwJyxcbiAgU0VMRUNUX1JFTCA9ICdzZWxlY3RSZWxhdGlvbnNoaXAnLFxuICBTRUFSQ0ggPSAnc2VhcmNoJyxcbiAgQ1JFQVRFID0gJ2NyZWF0ZScsXG4gIFVQREFURSA9ICd1cGRhdGUnLFxuICBERUxFVEUgPSAnZGVsZXRlJyxcbiAgREVMRVRFX0NBU0NBREVTID0gJ2RlbGV0ZUNhc2NhZGVzJ1xufVxuXG5pbnRlcmZhY2UgUXVlcnlPYmplY3Qge1xuICBbazogc3RyaW5nXTogdHJ1ZSB8IFF1ZXJ5T2JqZWN0XG59XG5cbmNvbnN0IGdldFJlcXVpcmVkRmllbGRzID0gKG1vZGVsOiBhbnkpID0+XG4gIFIudW5pb24oWydfX3R5cGVOYW1lJywgJ2lkJ10sIFIucGF0aE9yKFtdLCBbJ3F1ZXJ5UmVxdWlyZWQnXSwgbW9kZWwpKVxuXG5jb25zdCBnZXRSZWxUYWJsZUZpZWxkcyA9ICh7XG4gIGZpZWxkTmFtZSxcbiAgbW9kZWxcbn06IHtcbiAgZmllbGROYW1lOiBzdHJpbmdcbiAgbW9kZWw6IGFueVxufSkgPT4gUi5wYXRoT3IoW10sIFsnZmllbGRzJywgZmllbGROYW1lLCAndHlwZScsICd0YWJsZUZpZWxkcyddLCBtb2RlbClcblxuY29uc3QgZ2V0UXVlcnlOYW1lID0gKFxuICBzY2hlbWE6IFNjaGVtYUJ1aWxkZXIsXG4gIG1vZGVsTmFtZTogc3RyaW5nLFxuICBxdWVyeVR5cGU6IFF1ZXJ5VHlwZVxuKSA9PiB7XG4gIGNvbnN0IG1vZGVsOiBhbnkgPSBzY2hlbWEuZ2V0TW9kZWwobW9kZWxOYW1lKVxuICBzd2l0Y2ggKHF1ZXJ5VHlwZSkge1xuICAgIGNhc2UgUXVlcnlUeXBlLklOREVYOlxuICAgIGNhc2UgUXVlcnlUeXBlLlNFTEVDVDpcbiAgICAgIHJldHVybiBtb2RlbC5xdWVyeUFsbE5hbWVcbiAgICBjYXNlIFF1ZXJ5VHlwZS5ERVRBSUw6XG4gICAgY2FzZSBRdWVyeVR5cGUuVE9PTFRJUDpcbiAgICAgIHJldHVybiBtb2RlbC5xdWVyeU5hbWVcbiAgICBjYXNlIFF1ZXJ5VHlwZS5DUkVBVEU6XG4gICAgY2FzZSBRdWVyeVR5cGUuVVBEQVRFOlxuICAgIGNhc2UgUXVlcnlUeXBlLkRFTEVURTpcbiAgICAgIHJldHVybiBtb2RlbC5xdWVyeU5hbWVcbiAgICBkZWZhdWx0OlxuICAgICAgcmV0dXJuIHF1ZXJ5VHlwZVxuICB9XG59XG5cbmNvbnN0IGdldFNvcnRWYXJpYWJsZSA9IChtb2RlbE5hbWU6IHN0cmluZykgPT4gYCR7bW9kZWxOYW1lfVNvcnRgXG5cbmNvbnN0IGdldExpc3RWYXJpYWJsZXMgPSAobW9kZWxOYW1lOiBzdHJpbmcpID0+ICh7XG4gIGZpbHRlcjogYCR7bW9kZWxOYW1lfUZpbHRlcmAsXG4gIHNvcnQ6IGBbJHtnZXRTb3J0VmFyaWFibGUobW9kZWxOYW1lKX0hXWAsXG4gIHBhZ2U6ICdQYWdlJ1xufSlcblxuY29uc3QgZGV0YWlsVmFyaWFibGVzID0ge1xuICBpZDogJ0ludCEnXG59XG5cbmNvbnN0IGdldFZhcmlhYmxlcyA9ICh7XG4gIG1vZGVsTmFtZSxcbiAgcXVlcnlUeXBlXG59OiB7XG4gIG1vZGVsTmFtZTogc3RyaW5nXG4gIHF1ZXJ5VHlwZTogUXVlcnlUeXBlXG59KSA9PiB7XG4gIHN3aXRjaCAocXVlcnlUeXBlKSB7XG4gICAgY2FzZSBRdWVyeVR5cGUuSU5ERVg6XG4gICAgICByZXR1cm4gZ2V0TGlzdFZhcmlhYmxlcyhtb2RlbE5hbWUpXG4gICAgY2FzZSBRdWVyeVR5cGUuREVMRVRFOlxuICAgIGNhc2UgUXVlcnlUeXBlLkRFVEFJTDpcbiAgICBjYXNlIFF1ZXJ5VHlwZS5UT09MVElQOlxuICAgICAgcmV0dXJuIGRldGFpbFZhcmlhYmxlc1xuICAgIGNhc2UgUXVlcnlUeXBlLlNFTEVDVDpcbiAgICAgIHJldHVybiB7IHNvcnQ6IGBbJHtnZXRTb3J0VmFyaWFibGUobW9kZWxOYW1lKX0hXWAgfVxuICAgIGNhc2UgUXVlcnlUeXBlLlNFQVJDSDpcbiAgICAgIHJldHVybiB7IHF1ZXJ5U3RyaW5nOiAnU3RyaW5nIScgfVxuICAgIGNhc2UgUXVlcnlUeXBlLkNSRUFURTpcbiAgICAgIHJldHVybiB7IGlucHV0OiBgJHttb2RlbE5hbWV9SW5wdXRSZXF1aXJlZCFgIH1cbiAgICBjYXNlIFF1ZXJ5VHlwZS5VUERBVEU6XG4gICAgICByZXR1cm4geyBpbnB1dDogYCR7bW9kZWxOYW1lfUlucHV0IWAsIGlkOiAnSW50IScgfVxuICAgIGNhc2UgUXVlcnlUeXBlLkRFTEVURV9DQVNDQURFUzpcbiAgICAgIHJldHVybiB7IG1vZGVsTmFtZTogJ1N0cmluZyEnLCBpZDogJ0ludCEnIH1cbiAgfVxufVxuXG5jb25zdCBnZXRBcmdzID0gKHF1ZXJ5VHlwZTogUXVlcnlUeXBlKSA9PiB7XG4gIHN3aXRjaCAocXVlcnlUeXBlKSB7XG4gICAgY2FzZSBRdWVyeVR5cGUuSU5ERVg6XG4gICAgICByZXR1cm4ge1xuICAgICAgICBmaWx0ZXI6IG5ldyBWYXJpYWJsZVR5cGUoJ2ZpbHRlcicpLFxuICAgICAgICBzb3J0OiBuZXcgVmFyaWFibGVUeXBlKCdzb3J0JyksXG4gICAgICAgIHBhZ2U6IG5ldyBWYXJpYWJsZVR5cGUoJ3BhZ2UnKVxuICAgICAgfVxuICAgIGNhc2UgUXVlcnlUeXBlLkRFTEVURTpcbiAgICBjYXNlIFF1ZXJ5VHlwZS5ERVRBSUw6XG4gICAgY2FzZSBRdWVyeVR5cGUuVE9PTFRJUDpcbiAgICAgIHJldHVybiB7IGlkOiBuZXcgVmFyaWFibGVUeXBlKCdpZCcpIH1cbiAgICBjYXNlIFF1ZXJ5VHlwZS5TRUxFQ1Q6XG4gICAgICByZXR1cm4geyBzb3J0OiBuZXcgVmFyaWFibGVUeXBlKCdzb3J0JykgfVxuICAgIGNhc2UgUXVlcnlUeXBlLlNFQVJDSDpcbiAgICAgIHJldHVybiB7IHF1ZXJ5U3RyaW5nOiBuZXcgVmFyaWFibGVUeXBlKCdxdWVyeVN0cmluZycpIH1cbiAgICBjYXNlIFF1ZXJ5VHlwZS5DUkVBVEU6XG4gICAgICByZXR1cm4geyBpbnB1dDogbmV3IFZhcmlhYmxlVHlwZSgnaW5wdXQnKSB9XG4gICAgY2FzZSBRdWVyeVR5cGUuVVBEQVRFOlxuICAgICAgcmV0dXJuIHsgaW5wdXQ6IG5ldyBWYXJpYWJsZVR5cGUoJ2lucHV0JyksIGlkOiBuZXcgVmFyaWFibGVUeXBlKCdpZCcpIH1cbiAgICBjYXNlIFF1ZXJ5VHlwZS5ERUxFVEVfQ0FTQ0FERVM6XG4gICAgICByZXR1cm4ge1xuICAgICAgICB0YWJsZU5hbWU6IG5ldyBWYXJpYWJsZVR5cGUoJ21vZGVsTmFtZScpLFxuICAgICAgICBpZDogbmV3IFZhcmlhYmxlVHlwZSgnaWQnKVxuICAgICAgfVxuICB9XG59XG5cbmNvbnN0IGdldEZpZWxkUXVlcnlUeXBlID0gKHF1ZXJ5VHlwZTogUXVlcnlUeXBlKSA9PiB7XG4gIHN3aXRjaCAocXVlcnlUeXBlKSB7XG4gICAgY2FzZSBRdWVyeVR5cGUuSU5ERVg6XG4gICAgICByZXR1cm4gUXVlcnlUeXBlLklOREVYX1JFTFxuICAgIGNhc2UgUXVlcnlUeXBlLkRFVEFJTDpcbiAgICAgIHJldHVybiBRdWVyeVR5cGUuREVUQUlMX1JFTFxuICAgIGNhc2UgUXVlcnlUeXBlLlNFTEVDVDpcbiAgICAgIHJldHVybiBRdWVyeVR5cGUuU0VMRUNUX1JFTFxuICAgIGRlZmF1bHQ6XG4gICAgICByZXR1cm4gcXVlcnlUeXBlXG4gIH1cbn1cblxuY29uc3QgZ2V0UXVlcnlJbmRleEZpZWxkcyA9IChzY2hlbWE6IGFueSwgbW9kZWxOYW1lOiBzdHJpbmcpID0+IHtcbiAgY29uc3QgaW5kZXhGaWVsZHMgPSBzY2hlbWEuZ2V0SW5kZXhGaWVsZHMoeyBtb2RlbE5hbWUsIGN1c3RvbVByb3BzOiB7fSB9KVxuICBjb25zdCBmaWVsZHMgPSBSLnBpcGUoXG4gICAgUi5wcm9wPHN0cmluZywgYW55PignZmllbGRzJyksXG4gICAgUi5tYXAoXG4gICAgICAoZmllbGQ6IGFueSkgPT5cbiAgICAgICAgUi5pbmNsdWRlcyhSLnByb3AoJ2ZpZWxkTmFtZScsIGZpZWxkKSwgaW5kZXhGaWVsZHMpIHx8XG4gICAgICAgIFIucHJvcCgncXVlcnlJbmRleCcsIGZpZWxkKVxuICAgIClcbiAgKShzY2hlbWEuZ2V0TW9kZWwobW9kZWxOYW1lKSlcbiAgcmV0dXJuIFIuZmlsdGVyKFIuaWRlbnRpdHksIGZpZWxkcylcbn1cblxuY29uc3QgZ2V0UXVlcnlEZXRhaWxGaWVsZHMgPSAoc2NoZW1hOiBhbnksIG1vZGVsTmFtZTogYW55KSA9PiB7XG4gIGNvbnN0IGZpZWxkcyA9IFIuZmlsdGVyKFxuICAgIChmaWVsZDogYW55KSA9PlxuICAgICAgKFIucHJvcE9yKHRydWUsICdzaG93RGV0YWlsJywgZmllbGQpIHx8IFIucHJvcCgncXVlcnlEZXRhaWwnLCBmaWVsZCkpICYmXG4gICAgICAhUi5wcm9wKCd2aXJ0dWFsRmllbGQnLCBmaWVsZCksXG4gICAgc2NoZW1hLmdldEZpZWxkcyhtb2RlbE5hbWUpXG4gIClcbiAgY29uc3QgbW9kZWwgPSBzY2hlbWEuZ2V0TW9kZWwobW9kZWxOYW1lKVxuICByZXR1cm4gUi5tYXBPYmpJbmRleGVkKCh2YWwsIGtleSkgPT4ge1xuICAgIGNvbnN0IHNob3cgPVxuICAgICAgUi5wYXRoT3IodHJ1ZSwgWydmaWVsZHMnLCBrZXksICdzaG93RGV0YWlsJ10sIG1vZGVsKSB8fFxuICAgICAgUi5wYXRoKFsnZmllbGRzJywga2V5LCAncXVlcnlEZXRhaWwnXSwgbW9kZWwpXG4gICAgcmV0dXJuIFIucGF0aE9yKHNob3csIFsnZmllbGRzJywga2V5LCAndHlwZScsICd0eXBlJ10sIG1vZGVsKVxuICB9LCBmaWVsZHMpXG59XG4vLyBuZWVkcyB0byBiZSByZW1vdmVkP1xuY29uc3QgbWFrZVJlbGF5Tm9kZUNvbm5lY3Rpb24gPSAobm9kZVF1ZXJ5T2JqOiBhbnkpID0+ICh7XG4gIF9fdHlwZW5hbWU6IHRydWUsXG4gIC4uLm5vZGVRdWVyeU9ialxufSlcblxuY29uc3QgZ2V0UmVsRmllbGRPYmplY3QgPSAoe1xuICBzY2hlbWEsXG4gIG1vZGVsTmFtZSxcbiAgZmllbGROYW1lXG59OiB7XG4gIHNjaGVtYTogU2NoZW1hQnVpbGRlclxuICBtb2RlbE5hbWU6IHN0cmluZ1xuICBmaWVsZE5hbWU6IHN0cmluZ1xufSkgPT4ge1xuICBjb25zdCByZWxGaWVsZE9iamVjdDogUXVlcnlPYmplY3QgPSB7XG4gICAgaWQ6IHRydWVcbiAgfVxuICBjb25zdCB0YXJnZXRNb2RlbCA9IFIucGF0aChcbiAgICBbJ3R5cGUnLCAndGFyZ2V0J10sXG4gICAgc2NoZW1hLmdldEZpZWxkKG1vZGVsTmFtZSwgZmllbGROYW1lKVxuICApIGFzIHN0cmluZ1xuICBjb25zdCB0YXJnZXRNb2RlbERpc3BsYXlGaWVsZCA9IFIucHJvcE9yKFxuICAgICduYW1lJyxcbiAgICAnZGlzcGxheUZpZWxkJyxcbiAgICBzY2hlbWEuZ2V0TW9kZWwodGFyZ2V0TW9kZWwpXG4gICkgYXMgc3RyaW5nXG4gIGlmICh0YXJnZXRNb2RlbERpc3BsYXlGaWVsZCkge1xuICAgIHJlbEZpZWxkT2JqZWN0W3RhcmdldE1vZGVsRGlzcGxheUZpZWxkXSA9IHRydWVcbiAgfSAvLyB0b2RvOiB0YXJnZXRNb2RlbERpc3BsYXlGaWVsZCBjYW4gYmUgZnVuY3Rpb24gYW5kIG5vdCBzdHJpbmc/Pz9cbiAgcmV0dXJuIHJlbEZpZWxkT2JqZWN0XG59XG5cbmNvbnN0IGJ1aWxkVG9vbHRpcEZpZWxkc09iamVjdCA9ICh7XG4gIHNjaGVtYSxcbiAgbW9kZWxOYW1lXG59OiB7XG4gIHNjaGVtYTogU2NoZW1hQnVpbGRlclxuICBtb2RlbE5hbWU6IHN0cmluZ1xufSkgPT4ge1xuICAvLyB0b2RvOiBpbnNlcnQgY3VzdG9tUHJvcHMgZnJvbSBvdXRzaWRlIGFwcGxpY2F0aW9uXG4gIGNvbnN0IGZpZWxkcyA9IHNjaGVtYS5nZXRUb29sdGlwRmllbGRzKHsgbW9kZWxOYW1lLCBjdXN0b21Qcm9wczoge30gfSlcbiAgcmV0dXJuIFIucGlwZShcbiAgICBSLnJlZHVjZSgoYWNjdW11bGF0b3IsIGZpZWxkTmFtZTogc3RyaW5nKSA9PiB7XG4gICAgICBjb25zdCB0eXBlID0gc2NoZW1hLmdldFR5cGUobW9kZWxOYW1lLCBmaWVsZE5hbWUpXG4gICAgICBpZiAodHlwZS5pbmNsdWRlcygnVG9NYW55JykpIHtcbiAgICAgICAgcmV0dXJuIFIuYXNzb2MoXG4gICAgICAgICAgZmllbGROYW1lLFxuICAgICAgICAgIG1ha2VSZWxheU5vZGVDb25uZWN0aW9uKFxuICAgICAgICAgICAgZ2V0UmVsRmllbGRPYmplY3QoeyBzY2hlbWEsIG1vZGVsTmFtZSwgZmllbGROYW1lIH0pXG4gICAgICAgICAgKSxcbiAgICAgICAgICBhY2N1bXVsYXRvclxuICAgICAgICApXG4gICAgICB9IGVsc2UgaWYgKHR5cGUuaW5jbHVkZXMoJ1RvT25lJykpIHtcbiAgICAgICAgcmV0dXJuIFIuYXNzb2MoXG4gICAgICAgICAgZmllbGROYW1lLFxuICAgICAgICAgIGdldFJlbEZpZWxkT2JqZWN0KHsgc2NoZW1hLCBtb2RlbE5hbWUsIGZpZWxkTmFtZSB9KSxcbiAgICAgICAgICBhY2N1bXVsYXRvclxuICAgICAgICApXG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gUi5hc3NvYyhmaWVsZE5hbWUsIHRydWUsIGFjY3VtdWxhdG9yKVxuICAgICAgfVxuICAgIH0sIHt9KVxuICApKGZpZWxkcylcbn1cblxuY29uc3QgcGlja0ZpZWxkcyA9IChhcnI6IHN0cmluZ1tdLCBmaWVsZHM6IGFueSk6IG9iamVjdCA9PlxuICBSLnBpY2tCeSgodmFsLCBrZXkpID0+IFIuaW5jbHVkZXMoa2V5LCBhcnIpLCBmaWVsZHMpXG5cbmNvbnN0IGJ1aWxkRmllbGRzT2JqZWN0ID0gKHtcbiAgc2NoZW1hLFxuICBxdWVyeVR5cGUsXG4gIG1vZGVsTmFtZSxcbiAgcXVlcnlGaWVsZHMgPSBbXVxufToge1xuICBzY2hlbWE6IFNjaGVtYUJ1aWxkZXJcbiAgcXVlcnlUeXBlOiBRdWVyeVR5cGVcbiAgbW9kZWxOYW1lOiBzdHJpbmdcbiAgcXVlcnlGaWVsZHM/OiBzdHJpbmdbXVxufSkgPT4ge1xuICBjb25zdCBtb2RlbCA9IHNjaGVtYS5nZXRNb2RlbChtb2RlbE5hbWUpXG4gIGNvbnN0IHJlcXVpcmVkID0gZ2V0UmVxdWlyZWRGaWVsZHMobW9kZWwpXG4gIGNvbnN0IHJlcXVpcmVkT2JqID0gcmVxdWlyZWQucmVkdWNlKFxuICAgIChhY2MsIHZhbCkgPT4gKHsgLi4uYWNjLCBbdmFsXTogdHJ1ZSB9KSxcbiAgICB7fVxuICApXG5cbiAgaWYgKHF1ZXJ5VHlwZSA9PT0gUXVlcnlUeXBlLlRPT0xUSVApIHtcbiAgICByZXR1cm4gYnVpbGRUb29sdGlwRmllbGRzT2JqZWN0KHsgc2NoZW1hLCBtb2RlbE5hbWUgfSlcbiAgfVxuXG4gIGxldCBmaWVsZHMgPSAoKCk6IG9iamVjdCA9PiB7XG4gICAgc3dpdGNoIChxdWVyeVR5cGUpIHtcbiAgICAgIGNhc2UgUXVlcnlUeXBlLklOREVYOlxuICAgICAgICByZXR1cm4gZ2V0UXVlcnlJbmRleEZpZWxkcyhzY2hlbWEsIG1vZGVsTmFtZSlcbiAgICAgIGNhc2UgUXVlcnlUeXBlLkRFVEFJTDpcbiAgICAgICAgcmV0dXJuIGdldFF1ZXJ5RGV0YWlsRmllbGRzKHNjaGVtYSwgbW9kZWxOYW1lKVxuICAgICAgY2FzZSBRdWVyeVR5cGUuREVUQUlMX1JFTDpcbiAgICAgICAgcmV0dXJuIHBpY2tGaWVsZHMocXVlcnlGaWVsZHMsIGdldFF1ZXJ5RGV0YWlsRmllbGRzKHNjaGVtYSwgbW9kZWxOYW1lKSlcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHJldHVybiB7fVxuICAgIH1cbiAgfSkoKVxuICBmaWVsZHMgPSBSLm1lcmdlRGVlcExlZnQocmVxdWlyZWRPYmosIGZpZWxkcylcbiAgLy8gcmVwbGFjZSB3aXRoIHF1ZXJ5IG9iamVjdCB3aGVuIGZpZWxkTmFtZSBpcyBSZWxhdGlvbnNoaXAgdHlwZVxuICBmaWVsZHMgPSBSLm1hcE9iakluZGV4ZWQoKHZhbCwga2V5KSA9PiB7XG4gICAgY29uc3QgZmllbGQgPSBzY2hlbWEuZ2V0RmllbGQobW9kZWxOYW1lLCBrZXkpXG4gICAgaWYgKCFzY2hlbWEuaXNSZWwobW9kZWxOYW1lLCBrZXkpKSB7XG4gICAgICByZXR1cm4gdmFsXG4gICAgfVxuXG4gICAgcmV0dXJuIGJ1aWxkRmllbGRzT2JqZWN0KHtcbiAgICAgIHNjaGVtYSxcbiAgICAgIHF1ZXJ5VHlwZTogZ2V0RmllbGRRdWVyeVR5cGUocXVlcnlUeXBlKSxcbiAgICAgIG1vZGVsTmFtZTogUi5wYXRoKFsndHlwZScsICd0YXJnZXQnXSwgZmllbGQpIGFzIHN0cmluZyxcbiAgICAgIHF1ZXJ5RmllbGRzOiBnZXRSZWxUYWJsZUZpZWxkcyh7IG1vZGVsLCBmaWVsZE5hbWU6IGtleSB9KVxuICAgIH0pXG4gIH0sIGZpZWxkcylcblxuICByZXR1cm4gZmllbGRzXG59XG5cbmNvbnN0IGJ1aWxkU2VhcmNoRmllbGRzQXJyYXkgPSAoc2NoZW1hOiBTY2hlbWFCdWlsZGVyKSA9PiB7XG4gIGNvbnN0IGZpZWxkc0FycmF5OiBvYmplY3RbXSA9IFtdXG4gIFIuZm9yRWFjaE9iakluZGV4ZWQobW9kZWwgPT4ge1xuICAgIGlmIChzY2hlbWEuZ2V0U2VhcmNoYWJsZShtb2RlbC5tb2RlbE5hbWUpKSB7XG4gICAgICBmaWVsZHNBcnJheS5wdXNoKGJ1aWxkU2VhcmNoRmllbGRzT2JqZWN0KHNjaGVtYSwgbW9kZWwpKVxuICAgIH1cbiAgfSwgc2NoZW1hLnNjaGVtYUpTT04pXG4gIHJldHVybiBmaWVsZHNBcnJheVxufVxuXG5jb25zdCBidWlsZFNlYXJjaEZpZWxkc09iamVjdCA9IChzY2hlbWE6IFNjaGVtYUJ1aWxkZXIsIG1vZGVsOiBhbnkpID0+IHtcbiAgY29uc3QgcmVxdWlyZWQgPSBnZXRSZXF1aXJlZEZpZWxkcyhtb2RlbClcbiAgY29uc3QgcmVxdWlyZWRPYmogPSByZXF1aXJlZC5yZWR1Y2UoXG4gICAgKGFjYywgdmFsKSA9PiAoeyAuLi5hY2MsIFt2YWxdOiB0cnVlIH0pLFxuICAgIHt9XG4gIClcblxuICBsZXQgZmllbGRzOiBRdWVyeU9iamVjdCA9IHt9XG4gIGZpZWxkcy5pZCA9IHRydWVcbiAgaWYgKFIudHlwZShtb2RlbC5kaXNwbGF5RmllbGQpID09PSAnU3RyaW5nJykge1xuICAgIGZpZWxkc1ttb2RlbC5kaXNwbGF5RmllbGRdID0gdHJ1ZVxuICB9XG5cbiAgZmllbGRzID0gUi5tZXJnZURlZXBMZWZ0KHJlcXVpcmVkT2JqLCBmaWVsZHMpXG5cbiAgZmllbGRzLl9fdHlwZU5hbWUgPSBtb2RlbC5tb2RlbE5hbWVcblxuICBmaWVsZHMgPSBSLm1hcE9iakluZGV4ZWQoKHZhbCwga2V5KSA9PiB7XG4gICAgY29uc3QgZmllbGQgPSBzY2hlbWEuZ2V0RmllbGQobW9kZWwubW9kZWxOYW1lLCBrZXkpXG4gICAgaWYgKCFzY2hlbWEuaXNSZWwobW9kZWwubW9kZWxOYW1lLCBrZXkpKSB7XG4gICAgICByZXR1cm4gdmFsXG4gICAgfVxuXG4gICAgcmV0dXJuIGJ1aWxkU2VhcmNoRmllbGRzT2JqZWN0KFxuICAgICAgc2NoZW1hLFxuICAgICAgc2NoZW1hLmdldE1vZGVsKFIucGF0aChbJ3R5cGUnLCAndGFyZ2V0J10sIGZpZWxkKSBhcyBzdHJpbmcpXG4gICAgKVxuICB9LCBmaWVsZHMpXG5cbiAgcmV0dXJuIGZpZWxkc1xufVxuXG5jb25zdCBidWlsZERlbGV0ZUNhc2NhZGVzQXJyYXkgPSAoc2NoZW1hOiBTY2hlbWFCdWlsZGVyKSA9PiB7XG4gIGNvbnN0IGNhc2NhZGVzQXJyYXk6IG9iamVjdFtdID0gW11cbiAgUi5mb3JFYWNoT2JqSW5kZXhlZChtb2RlbCA9PiB7XG4gICAgY2FzY2FkZXNBcnJheS5wdXNoKGJ1aWxkQ2FzY2FkZXNPYmplY3Qoc2NoZW1hLCBtb2RlbCkpXG4gIH0sIHNjaGVtYS5zY2hlbWFKU09OKVxuICByZXR1cm4gY2FzY2FkZXNBcnJheVxufVxuXG5jb25zdCBidWlsZENhc2NhZGVzT2JqZWN0ID0gKHNjaGVtYTogU2NoZW1hQnVpbGRlciwgbW9kZWw6IGFueSkgPT4ge1xuICBjb25zdCByZXF1aXJlZCA9IGdldFJlcXVpcmVkRmllbGRzKG1vZGVsKVxuICBjb25zdCByZXF1aXJlZE9iaiA9IHJlcXVpcmVkLnJlZHVjZShcbiAgICAoYWNjLCB2YWwpID0+ICh7IC4uLmFjYywgW3ZhbF06IHRydWUgfSksXG4gICAge31cbiAgKVxuXG4gIGxldCBjYXNjYWRlczogUXVlcnlPYmplY3QgPSB7fVxuICBjYXNjYWRlcy5fX3R5cGVuYW1lID0gdHJ1ZVxuICBjYXNjYWRlcy5pZCA9IHRydWVcbiAgaWYgKFIudHlwZShtb2RlbC5kaXNwbGF5RmllbGQpID09PSAnU3RyaW5nJykge1xuICAgIGNhc2NhZGVzW21vZGVsLmRpc3BsYXlGaWVsZF0gPSB0cnVlXG4gIH1cblxuICBjYXNjYWRlcyA9IFIubWVyZ2VEZWVwTGVmdChyZXF1aXJlZE9iaiwgY2FzY2FkZXMpXG5cbiAgY2FzY2FkZXMuX190eXBlTmFtZSA9IG1vZGVsLm1vZGVsTmFtZVxuXG4gIGNhc2NhZGVzID0gUi5tYXBPYmpJbmRleGVkKCh2YWwsIGtleSkgPT4ge1xuICAgIGNvbnN0IGZpZWxkID0gc2NoZW1hLmdldEZpZWxkKG1vZGVsLm1vZGVsTmFtZSwga2V5KVxuICAgIGlmICghc2NoZW1hLmlzUmVsKG1vZGVsLm1vZGVsTmFtZSwga2V5KSkge1xuICAgICAgcmV0dXJuIHZhbFxuICAgIH1cblxuICAgIHJldHVybiBidWlsZENhc2NhZGVzT2JqZWN0KFxuICAgICAgc2NoZW1hLFxuICAgICAgc2NoZW1hLmdldE1vZGVsKFIucGF0aChbJ3R5cGUnLCAndGFyZ2V0J10sIGZpZWxkKSBhcyBzdHJpbmcpXG4gICAgKVxuICB9LCBjYXNjYWRlcylcblxuICByZXR1cm4gY2FzY2FkZXNcbn1cblxuZXhwb3J0IGNvbnN0IG1ha2VRdWVyeUJ1aWxkZXIgPSAoc2NoZW1hOiBTY2hlbWFCdWlsZGVyKSA9PiB7XG4gIHJldHVybiAoe1xuICAgIG1vZGVsTmFtZSxcbiAgICBxdWVyeVR5cGUgPSBRdWVyeVR5cGUuSU5ERVhcbiAgfToge1xuICAgIG1vZGVsTmFtZTogc3RyaW5nXG4gICAgcXVlcnlUeXBlOiBRdWVyeVR5cGVcbiAgfSkgPT4ge1xuICAgIGNvbnN0IHF1ZXJ5TmFtZSA9IGdldFF1ZXJ5TmFtZShzY2hlbWEsIG1vZGVsTmFtZSwgcXVlcnlUeXBlKVxuICAgIGNvbnN0IHF1ZXJ5VmFyaWFibGVzID0gZ2V0VmFyaWFibGVzKHsgbW9kZWxOYW1lLCBxdWVyeVR5cGUgfSlcblxuICAgIHN3aXRjaCAocXVlcnlUeXBlKSB7XG4gICAgICBjYXNlIFF1ZXJ5VHlwZS5JTkRFWDpcbiAgICAgIGNhc2UgUXVlcnlUeXBlLkRFVEFJTDpcbiAgICAgIGNhc2UgUXVlcnlUeXBlLlNFTEVDVDpcbiAgICAgIGNhc2UgUXVlcnlUeXBlLlRPT0xUSVA6XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgcXVlcnk6IHtcbiAgICAgICAgICAgIF9fdmFyaWFibGVzOiBxdWVyeVZhcmlhYmxlcyxcbiAgICAgICAgICAgIFtxdWVyeU5hbWVdOiB7XG4gICAgICAgICAgICAgIF9fYXJnczogZ2V0QXJncyhxdWVyeVR5cGUpLFxuICAgICAgICAgICAgICByZXN1bHQ6IHtcbiAgICAgICAgICAgICAgICAuLi5idWlsZEZpZWxkc09iamVjdCh7IHNjaGVtYSwgbW9kZWxOYW1lLCBxdWVyeVR5cGUgfSlcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgZXJyb3JzOiB0cnVlLFxuICAgICAgICAgICAgICBjb3VudDogcXVlcnlUeXBlID09PSBRdWVyeVR5cGUuSU5ERVhcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIGNhc2UgUXVlcnlUeXBlLlNFQVJDSDpcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBxdWVyeToge1xuICAgICAgICAgICAgX192YXJpYWJsZXM6IHF1ZXJ5VmFyaWFibGVzLFxuICAgICAgICAgICAgc2VhcmNoOiB7XG4gICAgICAgICAgICAgIF9fYXJnczogZ2V0QXJncyhxdWVyeVR5cGUpLFxuICAgICAgICAgICAgICBfX3R5cGVuYW1lOiB0cnVlLFxuICAgICAgICAgICAgICBfX29uOiBidWlsZFNlYXJjaEZpZWxkc0FycmF5KHNjaGVtYSlcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIGNhc2UgUXVlcnlUeXBlLkNSRUFURTpcbiAgICAgIGNhc2UgUXVlcnlUeXBlLlVQREFURTpcbiAgICAgIGNhc2UgUXVlcnlUeXBlLkRFTEVURTpcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBtdXRhdGlvbjoge1xuICAgICAgICAgICAgX192YXJpYWJsZXM6IHF1ZXJ5VmFyaWFibGVzLFxuICAgICAgICAgICAgW2Ake3F1ZXJ5VHlwZX0ke21vZGVsTmFtZX1gXToge1xuICAgICAgICAgICAgICBfX2FyZ3M6IGdldEFyZ3MocXVlcnlUeXBlKSxcbiAgICAgICAgICAgICAgcmVzdWx0OiB7XG4gICAgICAgICAgICAgICAgX190eXBlbmFtZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICBpZDogdHJ1ZVxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBlcnJvcnM6IHRydWVcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIGNhc2UgUXVlcnlUeXBlLkRFTEVURV9DQVNDQURFUzpcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBxdWVyeToge1xuICAgICAgICAgICAgX192YXJpYWJsZXM6IHF1ZXJ5VmFyaWFibGVzLFxuICAgICAgICAgICAgY2hlY2tEZWxldGU6IHtcbiAgICAgICAgICAgICAgX19hcmdzOiBnZXRBcmdzKHF1ZXJ5VHlwZSksXG4gICAgICAgICAgICAgIF9fb246IGJ1aWxkRGVsZXRlQ2FzY2FkZXNBcnJheShzY2hlbWEpXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICB9XG59XG4iXX0=